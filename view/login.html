<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link href="../assets/img/nocua.png" rel="icon">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/login.css">
</head>
<body>
<section class="section">
    <div class="contenedor">
        <div class="loader"></div>
        <script src="../assets/js/loader.js"></script>
    </div>
</section>
<main>
    <div class="contenedor__todo">
        <div class="caja__trasera">
            <div class="caja__trasera-login">
                <h3>¿Ya tienes una cuenta?</h3>
                <p>Inicia sesión para entrar en la página</p>
                <button id="btn__iniciar-sesion">Iniciar Sesión</button>
            </div>
            <div class="caja__trasera-register">
                <h3>¿Aún no tienes una cuenta?</h3>
                <p>Regístrate para que puedas iniciar sesión</p>
                <button id="btn__registrarse">Registrarse</button>
            </div>
        </div>

        <!--Formulario de Login y registro-->
        <div class="contenedor__login-register">
            <!--Login-->
            <form id="formLogin" method="POST" class="formulario__login">
                <a href="../index.html"><img class="atras" src="../assets/img/flecha-hacia-atras.png" alt="Atrás"></a>
                <h2>Iniciar Sesión</h2>
                <div class="form-floating mb-3">
                    <input type="email" class="form-control" id="loginEmail" name="email" placeholder=" " required>
                    <label for="loginEmail">Email</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="password" id="loginPassword" class="form-control" name="password" placeholder=" " required>
                    <label for="loginPassword">Contraseña</label>
                    <center>
                        <img class="ojitos" id="loginBoton" src="../assets/img/ojo.png" alt="Ver contraseña">
                    </center>
                </div>
                <center><a href="#" data-bs-toggle="modal" data-bs-target="#passwordRecoveryModal">¿Olvidaste tu contraseña?</a></center>
                <center><button type="submit" class="btn btn-primary">Entrar</button></center>
            </form>

            <!--Register-->
            <form id="formRegister" method="POST" class="formulario__register">
                <a href="../index.html"><img class="atras" src="../assets/img/flecha-hacia-atras.png" alt="Atrás"></a>
                <h2>Registrarse</h2>
                <div class="form-floating mb-3">
                    <input type="text" name="apellido" class="form-control" id="registerApellido" onkeyup="registerUsuario()" placeholder=" " required>
                    <label for="registerApellido">Apellido</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="text" name="nombre" class="form-control" id="registerNombre" onkeyup="registerUsuario()" placeholder=" " required>
                    <label for="registerNombre">Nombre</label>
                </div>
                <div class="form-floating mb-3">
                    <input readonly type="text" name="usuario" class="form-control" id="usuario" readonly placeholder=" " required>
                    <label for="usuario">Usuario</label>
                </div>
                <div class="form-floating mb-3">
                    <select name="genero" class="form-select" id="registerGenero" required>
                        <option value="" disabled selected>Seleccione su género</option>
                        <option value="M">Masculino</option>
                        <option value="F">Femenino</option>
                        <option value="O">Otro</option>
                    </select>
                    <label for="registerGenero">Género</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="email" name="email" class="form-control" id="registerEmail" placeholder=" " required>
                    <label for="registerEmail">Email</label>
                </div>
                <div class="form-floating mb-3">
                    <input type="password" id="registerPassword" name="password" class="form-control" placeholder=" " required>
                    <label for="registerPassword">Contraseña</label>
                    <center>
                        <img class="ojitos" id="registerBoton" src="../assets/img/ojo.png" alt="Ver contraseña">
                    </center>
                </div>
                <div class="form-check mb-3">
                    <input type="checkbox" id="check1" class="form-check-input" required>
                    <label for="check1" class="form-check-label" style="font-size: 1.1em;">
                        Acepto 
                        <a href="https://soysena-my.sharepoint.com/:b:/g/personal/bsnocua_soy_sena_edu_co/EZxr-2VY8ypBqhPe5B-gd38BVrwSs8TKv6l3R0skG6t9GQ?e=dRsKRk" target="_blank" class="terms-link" title="Lee nuestros términos y condiciones aquí">
                            <b>Términos y Condiciones</b>
                        </a>
                    </label>
                </div>
                <center><button type="submit" name="register" onclick="return ConfirmRegister()" class="btn btn-success">Registrarse</button></center>
            </form>
            <script src="register.js"></script>
        </div>
    </div>
</main>
<div class="modal fade" id="passwordRecoveryModal" tabindex="-1" aria-labelledby="passwordRecoveryLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="passwordRecoveryLabel">Recuperar Contraseña</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form action="../controller/security/restore_password_login#.js" method="post">
        <div class="modal-body">
          <div class="mb-3">
            <label for="recoveryEmail" class="form-label">Por favor ingresa tu correo electrónico para restablecer la contraseña.</label>
            <input type="email" class="form-control" id="recoveryEmail" name="email" placeholder="Correo electrónico" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          <button type="submit" class="btn btn-primary">Enviar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script type="text/javascript">
    function ConfirmRegister() {
        return confirm("Te vas a registrar en la página oficial de NOCUA WEB SOLUTIONS");
    }

    function registerUsuario() {
        var nombre = document.getElementById("registerNombre").value;
        var apellido = document.getElementById("registerApellido").value;
        document.getElementById("usuario").value = (nombre + "." + apellido).toUpperCase();
    }

    document.getElementById('loginBoton').addEventListener('click', function() {
        togglePasswordVisibility('loginPassword', 'loginBoton');
    });

    document.getElementById('registerBoton').addEventListener('click', function() {
        togglePasswordVisibility('registerPassword', 'registerBoton');
    });

    function togglePasswordVisibility(passwordFieldId, buttonId) {
        var passwordField = document.getElementById(passwordFieldId);
        var button = document.getElementById(buttonId);
        if (passwordField.type === "password") {
            passwordField.type = "text";
            button.src = "../assets/img/visible.png";
            setTimeout(function() {
                passwordField.type = "password";
                button.src = "../assets/img/ojo.png";
            }, 4000);
        } else {
            passwordField.type = "password";
            button.src = "../assets/img/ojo.png";
        }
    }
</script>

<script src="../assets/js/login.js"></script>
</body>
</html>
<script type="text/javascript">
document.querySelector('#passwordResetForm').addEventListener('submit', async (event) => {
    event.preventDefault(); // Prevenir el envío del formulario por defecto

    const email = document.querySelector('#email').value;

    try {
        const response = await fetch('/password-reset', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email }),
        });

        const result = await response.json();

        if (result.status === 'success') {
            alert('Se ha enviado un correo con las instrucciones para restablecer tu contraseña.');
        } else if (result.status === 'not_found') {
            alert('No se encontró una cuenta asociada con ese correo electrónico.');
        } else {
            alert('Hubo un error al enviar el correo. Por favor, inténtalo nuevamente.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Hubo un problema al procesar tu solicitud. Intenta nuevamente más tarde.');
    }
});
</script>